<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ì•”ì‚° í›ˆë ¨</title>
  <style>
    :root { --bg:#0b1020; --card:#121a33; --text:#eaf0ff; --muted:#a8b1d6; --accent:#6ee7ff; --good:#6dffb3; --bad:#ff6d8f; }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background: radial-gradient(1200px 700px at 20% 10%, #1a2a6c55, transparent),
                  radial-gradient(900px 600px at 90% 20%, #00c6ff33, transparent),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .app {
      width: min(920px, 100%);
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 16px;
    }
    @media (max-width: 840px) {
      .app { grid-template-columns: 1fr; }
    }
    .card {
      background: linear-gradient(180deg, #141c3a, var(--card));
      border: 1px solid #2a3566;
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 20px 50px #00000055;
    }
    .title {
      display:flex; align-items: baseline; justify-content: space-between;
      gap: 12px; margin-bottom: 8px;
    }
    h1 { font-size: 20px; margin: 0; letter-spacing: 0.2px; }
    .sub { color: var(--muted); font-size: 13px; }
    .row { display:flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .pill {
      padding: 8px 10px;
      border: 1px solid #2a3566;
      border-radius: 999px;
      color: var(--muted);
      font-size: 13px;
      background: #0e1530aa;
    }
    .pill strong { color: var(--text); }
    .problem {
      margin-top: 14px;
      display: grid;
      gap: 10px;
    }
    .equation {
      font-size: 44px;
      font-weight: 800;
      letter-spacing: 0.5px;
      line-height: 1.1;
      margin: 0;
    }
    .answerRow { display:flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    input[type="text"] {
      flex: 1;
      min-width: 200px;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid #2a3566;
      background: #0b1230;
      color: var(--text);
      font-size: 18px;
      outline: none;
    }
    input[type="text"]:focus { border-color: var(--accent); box-shadow: 0 0 0 3px #6ee7ff22; }
    button {
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid #2a3566;
      background: #101a3a;
      color: var(--text);
      cursor: pointer;
      font-size: 14px;
      transition: transform .05s ease, border-color .2s ease;
      user-select: none;
    }
    button:hover { border-color: #3c4aa0; }
    button:active { transform: translateY(1px); }
    .primary { border-color: #2d8fa0; background: #0f2b33; }
    .primary:hover { border-color: var(--accent); }
    .danger { border-color: #a03c63; background: #2b0f1c; }
    .danger:hover { border-color: var(--bad); }
    .feedback {
      min-height: 22px;
      font-size: 14px;
      margin-top: 2px;
    }
    .good { color: var(--good); }
    .bad { color: var(--bad); }
    .muted { color: var(--muted); }
    .settings {
      display: grid;
      gap: 12px;
      margin-top: 6px;
    }
    .setting {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items: center;
    }
    .setting label { color: var(--muted); font-size: 13px; }
    select, input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #2a3566;
      background: #0b1230;
      color: var(--text);
      outline: none;
    }
    .mini {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }
    .log {
      margin-top: 10px;
      border-top: 1px dashed #2a3566;
      padding-top: 10px;
      display: grid;
      gap: 8px;
    }
    .logItem {
      display:flex;
      justify-content: space-between;
      gap: 10px;
      font-size: 13px;
      color: var(--muted);
      padding: 8px 10px;
      border: 1px solid #22305c;
      background: #0b1230aa;
      border-radius: 12px;
    }
    .logItem b { color: var(--text); }
  </style>
</head>
<body>
  <div class="app">
    <!-- Main -->
    <section class="card" aria-label="ì•”ì‚° í›ˆë ¨">
      <div class="title">
        <h1>ì•”ì‚° í›ˆë ¨</h1>
        <div class="sub" id="modeHint">Enterë¡œ ì œì¶œ Â· Escë¡œ ê±´ë„ˆë›°ê¸°</div>
      </div>

      <div class="row">
        <div class="pill">ì ìˆ˜: <strong id="score">0</strong></div>
        <div class="pill">ì—°ì†ì •ë‹µ: <strong id="streak">0</strong></div>
        <div class="pill">ì •ë‹µë¥ : <strong id="acc">0%</strong></div>
        <div class="pill">ë‚¨ì€ì‹œê°„: <strong id="time">--</strong></div>
      </div>

      <div class="problem">
        <p class="equation" id="equation">ì‹œì‘ì„ ëˆŒëŸ¬ì¤˜!</p>

        <div class="answerRow">
          <input id="answer" type="text" inputmode="numeric" autocomplete="off" placeholder="ì •ë‹µ ì…ë ¥" disabled />
          <button class="primary" id="submit" disabled>ì œì¶œ</button>
          <button id="skip" disabled>ê±´ë„ˆë›°ê¸°</button>
        </div>

        <div class="feedback" id="feedback"></div>

        <div class="row">
          <button class="primary" id="start">ì‹œì‘</button>
          <button class="danger" id="stop" disabled>ì¤‘ì§€</button>
          <button id="reset">ì´ˆê¸°í™”</button>
        </div>
      </div>
    </section>

    <!-- Settings / Log -->
    <aside class="card" aria-label="ì„¤ì •">
      <div class="title">
        <h1>ì„¤ì •</h1>
        <div class="sub">ë„¤ ì‹¤ë ¥ì— ë§ì¶° ì¡°ì ˆ</div>
      </div>

      <div class="settings">
        <div class="setting">
          <label for="op">ì—°ì‚°</label>
          <select id="op">
            <option value="mix" selected>ì„ì–´ì„œ</option>
            <option value="add">ë§ì…ˆ</option>
            <option value="sub">ëº„ì…ˆ</option>
            <option value="mul">ê³±ì…ˆ</option>
            <option value="div">ë‚˜ëˆ—ì…ˆ(ì •ìˆ˜)</option>
          </select>
        </div>

        <div class="setting">
          <label for="digits">ë‚œì´ë„(ìë¦¿ìˆ˜)</label>
          <select id="digits">
            <option value="1">1ìë¦¬</option>
            <option value="2" selected>2ìë¦¬</option>
            <option value="3">3ìë¦¬</option>
          </select>
        </div>

        <div class="setting">
          <label for="timeLimit">ë¬¸ì œ ì œí•œì‹œê°„(ì´ˆ)</label>
          <input id="timeLimit" type="number" min="3" max="60" value="10"/>
        </div>

        <div class="setting">
          <label for="totalCount">ì„¸íŠ¸ ë¬¸ì œ ìˆ˜</label>
          <input id="totalCount" type="number" min="5" max="200" value="20"/>
        </div>

        <div class="mini">
          â€¢ ë‚˜ëˆ—ì…ˆì€ í•­ìƒ <b>ì •ìˆ˜ë¡œ ë”± ë–¨ì–´ì§€ê²Œ</b> ë‚˜ì™€.<br/>
          â€¢ ì •í™•ë„/ì—°ì†ì •ë‹µì„ ì˜¬ë¦¬ë©´ ë‚œì´ë„ ì˜¬ë ¤ë„ ë¼.<br/>
          â€¢ â€œì„ì–´ì„œâ€ëŠ” ë§ì…ˆ/ëº„ì…ˆ/ê³±ì…ˆ/ë‚˜ëˆ—ì…ˆì„ ëœë¤ìœ¼ë¡œ ë‚´.
        </div>

        <div class="log">
          <div class="row" style="justify-content:space-between; align-items:center;">
            <div class="sub">ìµœê·¼ ê¸°ë¡(ìµœëŒ€ 6ê°œ)</div>
            <button id="clearLog">ê¸°ë¡ ì§€ìš°ê¸°</button>
          </div>
          <div id="logList"></div>
        </div>
      </div>
    </aside>
  </div>

<script>
(() => {
  // ===== Helpers =====
  const $ = (id) => document.getElementById(id);
  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
  const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

  // ===== State =====
  const state = {
    running: false,
    current: null,     // { text, answer }
    score: 0,
    streak: 0,
    correct: 0,
    totalAnswered: 0,  // ì œì¶œ+ì˜¤ë‹µ+ìŠ¤í‚µ í¬í•¨(ì •í™•ë„ ê¸°ì¤€)
    remainingInSet: 0,
    timerId: null,
    timeLeft: 0,
    log: []
  };

  // ===== UI refs =====
  const equationEl = $("equation");
  const answerEl = $("answer");
  const feedbackEl = $("feedback");
  const scoreEl = $("score");
  const streakEl = $("streak");
  const accEl = $("acc");
  const timeEl = $("time");

  const startBtn = $("start");
  const stopBtn = $("stop");
  const resetBtn = $("reset");
  const submitBtn = $("submit");
  const skipBtn = $("skip");

  const opSel = $("op");
  const digitsSel = $("digits");
  const timeLimitInp = $("timeLimit");
  const totalCountInp = $("totalCount");

  const logListEl = $("logList");
  const clearLogBtn = $("clearLog");

  // ===== Problem generator =====
  function getRangeByDigits(d) {
    if (d === 1) return [0, 9];
    if (d === 2) return [10, 99];
    return [100, 999];
  }

  function pickOp() {
    const op = opSel.value;
    if (op !== "mix") return op;
    const ops = ["add", "sub", "mul", "div"];
    return ops[randInt(0, ops.length - 1)];
  }

  function makeProblem() {
    const digits = Number(digitsSel.value);
    const [min, max] = getRangeByDigits(digits);
    const op = pickOp();

    let a, b, text, ans;

    if (op === "add") {
      a = randInt(min, max);
      b = randInt(min, max);
      text = `${a} + ${b}`;
      ans = a + b;
    } else if (op === "sub") {
      // ìŒìˆ˜ ë°©ì§€: í° ìˆ˜ - ì‘ì€ ìˆ˜
      a = randInt(min, max);
      b = randInt(min, max);
      const hi = Math.max(a, b), lo = Math.min(a, b);
      text = `${hi} - ${lo}`;
      ans = hi - lo;
    } else if (op === "mul") {
      // ê³±ì…ˆì€ ë„ˆë¬´ ì»¤ì§€ëŠ” ê²ƒ ë°©ì§€: ìë¦¿ìˆ˜ì— ë”°ë¼ b ë²”ìœ„ ì¤„ì´ê¸°
      a = randInt(min, max);
      const bMax = digits === 3 ? 99 : max;
      b = randInt(min, bMax);
      text = `${a} Ã— ${b}`;
      ans = a * b;
    } else {
      // div: ì •ìˆ˜ë¡œ ë”± ë–¨ì–´ì§€ê²Œ ë§Œë“¤ê¸° (a Ã· b)
      // a = b * k í˜•íƒœë¡œ ë§Œë“¤ì
      const bMin = digits === 1 ? 2 : min; // 1ìë¦¬ë©´ 0,1 í”¼í•˜ê¸°
      b = randInt(bMin, max);
      const k = randInt(1, digits === 3 ? 99 : 20);
      a = b * k;
      text = `${a} Ã· ${b}`;
      ans = k;
    }

    return { text, answer: ans };
  }

  // ===== Timer =====
  function startTimer(seconds) {
    clearInterval(state.timerId);
    state.timeLeft = seconds;
    timeEl.textContent = String(state.timeLeft);

    state.timerId = setInterval(() => {
      state.timeLeft -= 1;
      timeEl.textContent = String(Math.max(0, state.timeLeft));
      if (state.timeLeft <= 0) {
        clearInterval(state.timerId);
        // ì‹œê°„ì´ˆê³¼ = ì˜¤ë‹µ ì²˜ë¦¬(ìŠ¤í‚µê³¼ êµ¬ë¶„)
        timeOut();
      }
    }, 1000);
  }

  function stopTimer() {
    clearInterval(state.timerId);
    state.timerId = null;
    timeEl.textContent = "--";
  }

  // ===== Rendering =====
  function renderStats() {
    scoreEl.textContent = String(state.score);
    streakEl.textContent = String(state.streak);
    const acc = state.totalAnswered === 0 ? 0 : Math.round((state.correct / state.totalAnswered) * 100);
    accEl.textContent = `${acc}%`;
  }

  function setFeedback(type, msg) {
    feedbackEl.className = "feedback";
    if (type === "good") feedbackEl.classList.add("good");
    if (type === "bad") feedbackEl.classList.add("bad");
    if (type === "muted") feedbackEl.classList.add("muted");
    feedbackEl.textContent = msg;
  }

  function setRunningUI(running) {
    state.running = running;
    answerEl.disabled = !running;
    submitBtn.disabled = !running;
    skipBtn.disabled = !running;
    startBtn.disabled = running;
    stopBtn.disabled = !running;
    opSel.disabled = running;
    digitsSel.disabled = running;
    timeLimitInp.disabled = running;
    totalCountInp.disabled = running;
  }

  function showProblem(p) {
    state.current = p;
    equationEl.textContent = p.text;
    answerEl.value = "";
    answerEl.focus();
  }

  // ===== Log =====
  function loadLog() {
    try {
      const raw = localStorage.getItem("mm_log_v1");
      state.log = raw ? JSON.parse(raw) : [];
    } catch {
      state.log = [];
    }
    renderLog();
  }

  function saveLog() {
    localStorage.setItem("mm_log_v1", JSON.stringify(state.log.slice(0, 6)));
  }

  function addLog(entry) {
    state.log.unshift(entry);
    state.log = state.log.slice(0, 6);
    saveLog();
    renderLog();
  }

  function renderLog() {
    logListEl.innerHTML = "";
    if (state.log.length === 0) {
      const div = document.createElement("div");
      div.className = "logItem";
      div.innerHTML = `<span>ê¸°ë¡ì´ ì•„ì§ ì—†ì–´</span><span>ğŸ™‚</span>`;
      logListEl.appendChild(div);
      return;
    }
    for (const item of state.log) {
      const div = document.createElement("div");
      div.className = "logItem";
      div.innerHTML = `<span><b>${item.date}</b> Â· ${item.count}ë¬¸ì œ</span><span>ì •ë‹µë¥  ${item.acc}% Â· ì ìˆ˜ ${item.score}</span>`;
      logListEl.appendChild(div);
    }
  }

  // ===== Game flow =====
  function nextProblem() {
    if (!state.running) return;

    if (state.remainingInSet <= 0) {
      finishSet();
      return;
    }

    const timeLimit = clamp(Number(timeLimitInp.value) || 10, 3, 60);
    showProblem(makeProblem());
    setFeedback("muted", `ë‚¨ì€ ë¬¸ì œ: ${state.remainingInSet}ê°œ`);
    startTimer(timeLimit);
  }

  function submit() {
    if (!state.running || !state.current) return;

    const raw = answerEl.value.trim();
    if (raw === "" || raw === "-" ) {
      setFeedback("muted", "ìˆ«ìë¥¼ ì…ë ¥í•´ì¤˜ ğŸ™‚");
      answerEl.focus();
      return;
    }

    const userAns = Number(raw);
    const correctAns = state.current.answer;

    state.totalAnswered += 1;

    if (Number.isFinite(userAns) && userAns === correctAns) {
      state.correct += 1;
      state.streak += 1;
      state.score += 10 + Math.min(20, state.streak); // ì—°ì†ë³´ë„ˆìŠ¤
      setFeedback("good", `ì •ë‹µ! (+${10 + Math.min(20, state.streak)}ì )`);
    } else {
      state.streak = 0;
      state.score = Math.max(0, state.score - 5);
      setFeedback("bad", `ì˜¤ë‹µâ€¦ ì •ë‹µì€ ${correctAns} ( -5ì  )`);
    }

    state.remainingInSet -= 1;
    renderStats();
    nextProblem();
  }

  function skip() {
    if (!state.running || !state.current) return;
    state.totalAnswered += 1;
    state.streak = 0;
    state.score = Math.max(0, state.score - 2);
    setFeedback("bad", `ê±´ë„ˆëœ€â€¦ ì •ë‹µì€ ${state.current.answer} ( -2ì  )`);
    state.remainingInSet -= 1;
    renderStats();
    nextProblem();
  }

  function timeOut() {
    if (!state.running || !state.current) return;
    state.totalAnswered += 1;
    state.streak = 0;
    state.score = Math.max(0, state.score - 3);
    setFeedback("bad", `ì‹œê°„ì´ˆê³¼â€¦ ì •ë‹µì€ ${state.current.answer} ( -3ì  )`);
    state.remainingInSet -= 1;
    renderStats();
    nextProblem();
  }

  function start() {
    const total = clamp(Number(totalCountInp.value) || 20, 5, 200);
    state.score = 0;
    state.streak = 0;
    state.correct = 0;
    state.totalAnswered = 0;
    state.remainingInSet = total;

    setRunningUI(true);
    renderStats();
    nextProblem();
  }

  function stop() {
    setRunningUI(false);
    stopTimer();
    equationEl.textContent = "ì¤‘ì§€ë¨";
    setFeedback("muted", "ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ì‹œì‘ ë²„íŠ¼!");
  }

  function resetAll() {
    stop();
    state.score = 0;
    state.streak = 0;
    state.correct = 0;
    state.totalAnswered = 0;
    state.remainingInSet = 0;
    state.current = null;

    equationEl.textContent = "ì‹œì‘ì„ ëˆŒëŸ¬ì¤˜!";
    answerEl.value = "";
    setFeedback("muted", "");
    renderStats();
  }

  function finishSet() {
    stopTimer();
    const acc = state.totalAnswered === 0 ? 0 : Math.round((state.correct / state.totalAnswered) * 100);
    equationEl.textContent = "ì„¸íŠ¸ ì™„ë£Œ ğŸ‰";
    setFeedback("good", `ë! ì •ë‹µ ${state.correct}/${state.totalAnswered} Â· ì •ë‹µë¥  ${acc}% Â· ì ìˆ˜ ${state.score}`);
    addLog({
      date: new Date().toLocaleDateString("ko-KR", { year:"numeric", month:"2-digit", day:"2-digit" }),
      count: state.totalAnswered,
      acc,
      score: state.score
    });
    setRunningUI(false);
  }

  // ===== Events =====
  submitBtn.addEventListener("click", submit);
  skipBtn.addEventListener("click", skip);
  startBtn.addEventListener("click", start);
  stopBtn.addEventListener("click", stop);
  resetBtn.addEventListener("click", resetAll);

  clearLogBtn.addEventListener("click", () => {
    state.log = [];
    saveLog();
    renderLog();
  });

  answerEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") submit();
    if (e.key === "Escape") skip();
  });

  // ì…ë ¥ì—ì„œ ìˆ«ì/ìŒìˆ˜ê¸°í˜¸ë§Œ í—ˆìš©(ë¶€ë“œëŸ½ê²Œ)
  answerEl.addEventListener("input", () => {
    answerEl.value = answerEl.value.replace(/[^\d-]/g, "");
  });

  // init
  loadLog();
  renderStats();
})();
</script>
</body>
</html>
