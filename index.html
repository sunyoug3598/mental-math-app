<!doctype html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>암산 훈련</title>
<style>
:root{--bg:#0b1020;--card:#121a33;--text:#eaf0ff;--muted:#a8b1d6;--accent:#6ee7ff;--good:#6dffb3;--bad:#ff6d8f;}
*{box-sizing:border-box;}
body{
margin:0;font-family:system-ui;
background:var(--bg);
color:var(--text);
display:grid;place-items:center;
min-height:100vh;padding:20px;
}
.app{width:min(900px,100%);display:grid;grid-template-columns:1.3fr 1fr;gap:15px;}
@media(max-width:800px){.app{grid-template-columns:1fr;}}
.card{background:var(--card);padding:18px;border-radius:18px;}
h1{margin:0;font-size:18px;}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
.pill{padding:6px 10px;border-radius:999px;background:#0f1733;font-size:13px;}
.problem{margin-top:15px;}
.equation{font-size:40px;font-weight:bold;margin:10px 0;}
input{padding:12px;border-radius:10px;border:1px solid #333;background:#0f1733;color:white;font-size:18px;}
button{padding:10px 12px;border-radius:10px;border:none;background:#1d2a5a;color:white;cursor:pointer;}
button.primary{background:#0f4c5c;}
button.danger{background:#5a1d2a;}
.feedback{min-height:22px;margin-top:6px;}
.good{color:var(--good);}
.bad{color:var(--bad);}
.muted{color:var(--muted);}
.logItem{
display:flex;justify-content:space-between;
background:#0f1733;padding:6px 8px;
border-radius:8px;margin-bottom:6px;
font-size:13px;
}
</style>
</head>
<body>

<div class="app">

<section class="card">
<h1>암산 훈련</h1>

<div class="row">
<div class="pill">점수: <span id="score">0</span></div>
<div class="pill">연속: <span id="streak">0</span></div>
<div class="pill">정답률: <span id="acc">0%</span></div>
<div class="pill">남은시간: <span id="time">--</span></div>
</div>

<div class="problem">
<div class="equation" id="equation">시작을 눌러줘!</div>

<div class="row">
<input id="answer" disabled placeholder="정답 입력"/>
<button class="primary" id="submit" disabled>제출</button>
<button id="skip" disabled>건너뛰기</button>
</div>

<div class="feedback muted" id="feedback"></div>

<div class="row" style="margin-top:10px;">
<button class="primary" id="start">시작</button>
<button class="danger" id="stop" disabled>중지</button>
<button id="reset">초기화</button>
</div>
</div>
</section>

<section class="card">
<h1>오답노트 (최대 20개)</h1>
<button id="clearWrong" style="margin:8px 0;">오답 지우기</button>
<div id="wrongList"></div>
</section>

</div>

<script>
const $=id=>document.getElementById(id);
const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

const state={
running:false,
current:null,
score:0,
streak:0,
correct:0,
total:0,
wrong:[]
};

const scoreEl=$("score");
const streakEl=$("streak");
const accEl=$("acc");
const timeEl=$("time");
const equationEl=$("equation");
const feedbackEl=$("feedback");
const answerEl=$("answer");

let timer=null;
let timeLeft=0;

function saveWrong(){
localStorage.setItem("mm_wrong_v2",JSON.stringify(state.wrong.slice(0,20)));
}
function loadWrong(){
const raw=localStorage.getItem("mm_wrong_v2");
state.wrong=raw?JSON.parse(raw):[];
renderWrong();
}
function renderWrong(){
const list=$("wrongList");
list.innerHTML="";
if(state.wrong.length===0){
list.innerHTML="<div class='logItem'>오답이 아직 없어 ✅</div>";
return;
}
state.wrong.forEach(w=>{
const div=document.createElement("div");
div.className="logItem";
div.innerHTML=`<span><b>${w.q}</b></span>
<span>내 답 ${w.user} · 정답 ${w.correct}</span>`;
list.appendChild(div);
});
}
function addWrong(q,user,correct){
state.wrong.unshift({q,user,correct});
saveWrong();
renderWrong();
}

function newProblem(){
const a=rand(10,99);
const b=rand(10,99);
state.current={text:`${a} + ${b}`,answer:a+b};
equationEl.textContent=state.current.text;
answerEl.value="";
startTimer(10);
}

function startTimer(sec){
clearInterval(timer);
timeLeft=sec;
timeEl.textContent=timeLeft;
timer=setInterval(()=>{
timeLeft--;
timeEl.textContent=timeLeft;
if(timeLeft<=0){
clearInterval(timer);
timeOut();
}
},1000);
}

function updateStats(){
scoreEl.textContent=state.score;
streakEl.textContent=state.streak;
const acc=state.total?Math.round(state.correct/state.total*100):0;
accEl.textContent=acc+"%";
}

function submit(){
if(!state.running)return;
const val=Number(answerEl.value);
state.total++;
if(val===state.current.answer){
state.correct++;
state.streak++;
state.score+=10;
feedbackEl.className="feedback good";
feedbackEl.textContent="정답!";
}else{
state.streak=0;
state.score=Math.max(0,state.score-5);
feedbackEl.className="feedback bad";
feedbackEl.textContent="오답!";
addWrong(state.current.text,answerEl.value,state.current.answer);
}
updateStats();
newProblem();
}

function skip(){
if(!state.running)return;
state.total++;
state.streak=0;
state.score=Math.max(0,state.score-2);
feedbackEl.className="feedback bad";
feedbackEl.textContent="건너뜀!";
addWrong(state.current.text,"SKIP",state.current.answer);
updateStats();
newProblem();
}

function timeOut(){
if(!state.running)return;
state.total++;
state.streak=0;
state.score=Math.max(0,state.score-3);
feedbackEl.className="feedback bad";
feedbackEl.textContent="시간초과!";
addWrong(state.current.text,"TIMEOUT",state.current.answer);
updateStats();
newProblem();
}

$("start").onclick=()=>{
state.running=true;
answerEl.disabled=false;
$("submit").disabled=false;
$("skip").disabled=false;
$("stop").disabled=false;
$("start").disabled=true;
newProblem();
};

$("stop").onclick=()=>{
state.running=false;
clearInterval(timer);
equationEl.textContent="중지됨";
};

$("submit").onclick=submit;
$("skip").onclick=skip;
$("reset").onclick=()=>{
location.reload();
};
$("clearWrong").onclick=()=>{
state.wrong=[];
saveWrong();
renderWrong();
};

answerEl.addEventListener("keydown",e=>{
if(e.key==="Enter")submit();
});

loadWrong();
updateStats();
</script>
</body>
</html>
